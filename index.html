<html>
  <head>
    <title>Kombucha Prototype</title>
    <style>
      body {
        font-family: Arial, sans-serif;
      }
      #chatform {
        display: flex;
      }
      #chatinput {
        flex: 1;
        padding: 0.5em;
        border: none;
        border-radius: 3px 0 0 3px;
      }
      button[type="submit"] {
        padding: 0.5em 1em;
        border: none;
        border-radius: 0 3px 3px 0;
        background-color: #3366BB;
        color: white;
      }
      #chatlog {
        padding: 1em;
        border: 1px solid #ccc;
        border-radius: 3px;
        max-height: calc(100vh - 10em);
        overflow-y: auto;
      }
      #chatlog p {
        margin: 0.5em 0;
      }
      #chatlog p.user {
        text-align: right;
        background-color: #CF9FFF;
      }
      #chatlog p.bot {
        text-align: left;
        background-color: #D3D3D3;
      }
      #suggestions {
        display: flex;
        flex-wrap: wrap;
        margin-top: 0.5em;
      }
      #suggestions button {
        margin: 0 0.5em 0.5em 0;
        padding: 0.5em 1em;
        border: 1px solid #ccc;
        border-radius: 3px;
        background-color: #FFFFFF;
      }
    </style>
  </head>

  <body onload="setUpTangle();">
    <h1>Kombucha Prototype</h1>
    <form id="chatform">
      <input type="text" id="chatinput" placeholder="Enter your question here...">
      <button type="submit">Send</button>
    </form>
    <div id="suggestions">
      <button type="button" data-message="What were apple's earnings in 2018?">What were apple's earnings in 2018?</button>
      <button type="button" data-message="What is top of mind for Tim Cook these days?">What is top of mind for Tim Cook these days?</button>
      <button type="button" data-message="Does Apple have supply chain issues?">Does Apple have supply chain issues?</button>
    </div>
    <span class="TKAdjustableNumber" data-var="treespace" data-min="150" data-max="900" data-step="10"></span>
    <div id="chatlog"></div>

    	<!-- script -->
	    <script type="text/javascript">

        function setUpTangle () {

  			var analysis1 = document.getElementById("treeAnalysis1");
	  		var analysis2 = document.getElementById("treeAnalysis2");
		  	var analysis4 = document.getElementById("solventAnalysis1");
			  var analysis5 = document.getElementById("climeworksAnalysis1");
			  var analysis6 = document.getElementById("ceAnalysis1");

  			var analysis1Tangle = new Tangle(analysis1, {
	  			initialize: function() {
		  			this.carbonintake = 10;
			  	},
				  update: function() {
					  this.treeamount = Math.round((this.carbonintake * 2000)/13);
			  	}
			  })

  			var analysis2Tangle = new Tangle(analysis2, {
	  			initialize: function() {
		  			this.treespace = 150;
			  		this.treeamount = 1538;
				  },
				  update: function() {
  					this.treespaceamount = Math.round((this.treespace * (this.treeamount)/1000)/10.76);
	  			}
		  	})

  			var analysis4Tangle = new Tangle(analysis4, {
	  			initialize: function() {
	  				this.carbonintake = 10;
	  			},
		  		update: function() {
		  			this.solventNeeded_mea = Math.round((this.carbonintake*(11/3))*(61.084/44.01));
		  			this.solventNeeded_mdea = Math.round((this.carbonintake*(11/3))*(119.164/44.01));
		  			this.solventNeeded_dea_dga = Math.round((this.carbonintake*(11/3))*(105.137/44.01));
	  			}
	  		})

  			var analysis5Tangle = new Tangle(analysis5, {
	  			initialize: function() {
	  				this.carbonintake = 10;
		  		},
  				update: function() {
  					this.climeDacsBuilt = Math.round(this.carbonintake/(4000*1.10231*(27/99))*1000);
	  			}
  			})

	  		var analysis6Tangle = new Tangle(analysis6, {
		  		initialize: function() {
			  		this.carbonintake = 10;
  				},
	  			update: function() {
		  			this.ceDacsBuilt = Math.round(this.carbonintake/(1000000*(27/99))*10000000);
  				}
	  		})

  			;
	  	}
    </script>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      const API_KEY = "temp";
      const chatform = document.getElementById("chatform");
      const chatinput = document.getElementById("chatinput");
      const chatlog = document.getElementById("chatlog");
      const suggestions = document.getElementById("suggestions");

      chatform.addEventListener("submit", (event) => {
        event.preventDefault();

        // Get the user's input
        const message = chatinput.value;

        // Clear the input field
        chatinput.value = "";

        // Add the user's message to the chat log
        const userMessage = document.createElement("p");
        userMessage.innerText = "You: " + message;
        userMessage.classList.add("user");
        chatlog.appendChild(userMessage);

        // Send the user's message to GPT-3
        axios.post("https://api.openai.com/v1/completions", {
          prompt: message,
          model: "text-davinci-002",
          temperature: 0.5,
          max_tokens: 2048,
          top_p: 1,
          frequency_penalty: 0,
          presence_penalty: 0,
        }, {
          headers: {
            "Content-Type": "application/json",
            "Authorization":  `Bearer ${API_KEY}`,
          },
        }).then((response) => {
          // Display the GPT-3 response in the chat log
          const botMessage = document.createElement("p");
          botMessage.innerText = "Bot: " + response.data.choices[0].text;
          chatlog.appendChild(botMessage);
        }).catch((error) => {
          console.error(error);
        });
      });
    </script>
    
  </body>
</html>
